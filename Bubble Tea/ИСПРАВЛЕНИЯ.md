# ‚ö†Ô∏è –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. ‚ùå ‚Üí ‚úÖ –ë—ç–∫–∞–ø –Ω–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–ª + —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –¥–≤–∞–∂–¥—ã
**–ü—Ä–∏—á–∏–Ω–∞:** `subprocess.run()` –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞—Å—å –ø–æ–≤—Ç–æ—Ä–Ω–æ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏–ª –Ω–∞ `subprocess.Popen()` - –∑–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ
- –§–∞–π–ª: `backup_manager.py`
- –¢–µ–ø–µ—Ä—å: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç, –±—ç–∫–∞–ø –≤ —Ñ–æ–Ω–µ

### 2. ‚ùå ‚Üí ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω `.env` —Ñ–∞–π–ª + —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 
- –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ Python –≤ `pg_dump_backup.bat` –ø–æ—Å–ª–µ –±—ç–∫–∞–ø–∞
- –°–æ–∑–¥–∞–Ω `test_telegram.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 3. ‚ùå ‚Üí ‚úÖ Alertmanager –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
**–ü—Ä–∏—á–∏–Ω–∞:** Flask app –ø–∞–¥–∞–ª, webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–ª + –Ω–µ –±—ã–ª–æ –ø—Ä–∞–≤–∏–ª –¥–ª—è exporter'–æ–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π `alertmanager_webhook.py` (–ø–æ—Ä—Ç 5001)
- –û–±–Ω–æ–≤–ª–µ–Ω `alertmanager.yml` –Ω–∞ `host.docker.internal:5001`
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è `PostgresExporterDown` –∏ `NodeExporterDown`

### 4. ‚ú® –ù–û–í–û–ï: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö
**–ß—Ç–æ:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
- –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞
- –°—É–º–º–∞ –∑–∞–∫–∞–∑–∞
- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
- –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã

### 5. ‚ú® –ù–û–í–û–ï: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∏–∑–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–∞—Ö
**–ß—Ç–æ:** –ö–æ–≥–¥–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –æ–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∏–∂–µ –º–∏–Ω–∏–º—É–º–∞ - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –°–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –Ω–∏–∂–µ –º–∏–Ω–∏–º—É–º–∞
- –¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫ / –º–∏–Ω–∏–º—É–º
- –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è

---

## üöÄ –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°:

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram (2 –º–∏–Ω—É—Ç—ã)

#### 1.1 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª
–û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ (–µ—Å–ª–∏ –Ω–µ—Ç):
```env
TELEGRAM_BOT_TOKEN=8532707422:AAFMlkLjU7aNzelZQqPq3_UIgqvoSjliwB8
TELEGRAM_CHAT_ID=–≤–∞—à_chat_id
```

#### 1.2 –ü–æ–ª—É—á–∏—Ç—å chat_id (–µ—Å–ª–∏ –Ω–µ—Ç)
```bash
python setup_telegram.py
```

#### 1.3 –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
```bash
python test_telegram.py
```
**–î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏:** "üß™ –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Bubble Tea"

---

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å webhook –¥–ª—è Alertmanager (1 –º–∏–Ω—É—Ç–∞)

```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏
start_alertmanager_webhook.bat
```

**–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:**
```
Alertmanager Webhook Server –¥–ª—è Telegram
Listening on http://localhost:5001/webhook/alert
```

---

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Alertmanager (1 –º–∏–Ω—É—Ç–∞)

```bash
cd monitoring
docker-compose restart alertmanager
```

---

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Prometheus (–≤–∞–∂–Ω–æ!)
```bash
cd monitoring
docker-compose restart prometheus
```
–≠—Ç–æ –æ–±–Ω–æ–≤–∏—Ç alert rules —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –¥–ª—è exporter'–æ–≤.

---

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë (5 –º–∏–Ω—É—Ç)

#### 5.1 –¢–µ—Å—Ç –±—ç–∫–∞–ø–∞
```bash
# –ß–µ—Ä–µ–∑ –≤–µ–±
http://localhost:5000/backup/create
# –°–æ–∑–¥–∞—Ç—å logical backup

# –ò–ª–∏ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
database\backup_scripts\pg_dump_backup.bat
```
**‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

#### 5.2 –¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
```bash
# –ß–µ—Ä–µ–∑ –≤–µ–±
http://localhost:5000/order/new
# –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
```
**‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:** 
- üõí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–ù–û–í–´–ô –ó–ê–ö–ê–ó #X"
- ‚ö†Ô∏è –ï—Å–ª–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–ù–ò–ó–ö–ò–ô –û–°–¢–ê–¢–û–ö"

#### 5.3 –¢–µ—Å—Ç Alertmanager (–ø–æ–ª–æ–∂–∏—Ç—å Flask)
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Flask app (Ctrl+C)
# –ü–æ–¥–æ–∂–¥–∞—Ç—å 1-2 –º–∏–Ω—É—Ç—ã
```
**‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:** üî¥ –ê–ª–µ—Ä—Ç "FlaskAppDown" –≤ Telegram

#### 5.4 –¢–µ—Å—Ç Alertmanager (—É–±–∏—Ç—å postgres_exporter)
```bash
cd monitoring
docker-compose stop postgres_exporter
# –ü–æ–¥–æ–∂–¥–∞—Ç—å 1-2 –º–∏–Ω—É—Ç—ã
```
**‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:** üî¥ –ê–ª–µ—Ä—Ç "PostgresExporterDown" –≤ Telegram

#### 5.5 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å exporter
```bash
docker-compose start postgres_exporter
# –ü–æ–¥–æ–∂–¥–∞—Ç—å 1-2 –º–∏–Ω—É—Ç—ã
```
**‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:** ‚úÖ –ê–ª–µ—Ä—Ç "RESOLVED" –≤ Telegram

---

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç:
```bash
python test_telegram.py
```
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–≤–æ–¥:
- ‚ùå BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –≤ .env
- ‚ùå CHAT_ID –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç—å setup_telegram.py
- ‚ùå –û–®–ò–ë–ö–ê ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω

### Alertmanager –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:
   ```
   curl http://localhost:5001/health
   ```
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Alertmanager:
   ```bash
   cd monitoring
   docker-compose logs alertmanager
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –≤ Prometheus:
   ```
   http://localhost:9090/alerts
   ```

### –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–≤–∞–∂–¥—ã:
- –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Del)
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Flask app

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

‚úÖ `backup_manager.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç (Popen –≤–º–µ—Å—Ç–æ run)
‚úÖ `pg_dump_backup.bat` - –¥–æ–±–∞–≤–ª–µ–Ω–æ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
‚úÖ `test_telegram.py` - —Ç–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚úÖ `alertmanager_webhook.py` - webhook —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 5001)
‚úÖ `alertmanager.yml` - –æ–±–Ω–æ–≤–ª—ë–Ω URL –Ω–∞ host.docker.internal:5001
‚úÖ `alert_rules.yml` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è exporter'–æ–≤
‚úÖ `start_alertmanager_webhook.bat` - –∑–∞–ø—É—Å–∫ webhook
‚úÖ `app.py` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö –∏ –Ω–∏–∑–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–∞—Ö

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

- [ ] `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç TELEGRAM_BOT_TOKEN –∏ TELEGRAM_CHAT_ID
- [ ] `python test_telegram.py` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
- [ ] `start_alertmanager_webhook.bat` –∑–∞–ø—É—â–µ–Ω
- [ ] Prometheus –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω (`docker-compose restart prometheus`)
- [ ] –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞—ë—Ç—Å—è –±–µ–∑ –¥–≤–æ–π–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
- [ ] –ë—ç–∫–∞–ø –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- [ ] –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ üõí
- [ ] –ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚ö†Ô∏è
- [ ] Alertmanager –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ postgres_exporter
- [ ] Alertmanager –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ Flask app

---

**–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** ~5-7 –º–∏–Ω—É—Ç

