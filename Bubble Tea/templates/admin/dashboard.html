{% extends "base.html" %}
{% block title %}Панель управления — Админ BibaBobaBebe{% endblock %}

{% block content %}

<!-- ── Page header ─────────────────────────────────────────────── -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <p class="mb-0"
            style="font-size:0.72rem; text-transform:uppercase; letter-spacing:0.1em; color:#aaa; font-weight:600;">
            Панель администратора</p>
        <h1
            style="font-size:1.5rem; font-weight:700; letter-spacing:-0.02em; color:var(--espresso); margin:0.1rem 0 0;">
            Панель управления
        </h1>
    </div>
    <div class="text-end">
        <div style="font-size:0.82rem; color:#888;">
            Добро пожаловать, <strong style="color:var(--espresso);">{{ current_user.full_name or current_user.username
                }}</strong>
        </div>
        <div style="font-size:0.75rem; color:#bbb;" id="dashClock"></div>
    </div>
</div>

<!-- ── Stat cards ──────────────────────────────────────────────── -->
<div class="row g-3 mb-4">

    <div class="col-md-3 col-sm-6">
        <div class="card" style="border-left:3px solid var(--coffee);">
            <div class="card-body d-flex align-items-center gap-3" style="padding:1.1rem;">
                <div
                    style="width:44px; height:44px; background:var(--steam); border-radius:2px; display:flex; align-items:center; justify-content:center; flex-shrink:0;">
                    <i class="bi bi-cup-straw" style="font-size:1.3rem; color:var(--caramel);"></i>
                </div>
                <div>
                    <div style="font-size:1.7rem; font-weight:700; color:var(--espresso); line-height:1;">{{
                        total_products }}</div>
                    <div
                        style="font-size:0.75rem; color:#aaa; text-transform:uppercase; letter-spacing:0.05em; margin-top:0.1rem;">
                        Продуктов</div>
                </div>
                <a href="{{ url_for('admin_products') }}" class="ms-auto btn btn-sm btn-outline-primary"
                    style="font-size:0.72rem; white-space:nowrap;">Управление</a>
            </div>
        </div>
    </div>

    <div class="col-md-3 col-sm-6">
        <div class="card" style="border-left:3px solid #2D6A4F;">
            <div class="card-body d-flex align-items-center gap-3" style="padding:1.1rem;">
                <div
                    style="width:44px; height:44px; background:var(--steam); border-radius:2px; display:flex; align-items:center; justify-content:center; flex-shrink:0;">
                    <i class="bi bi-receipt" style="font-size:1.3rem; color:#2D6A4F;"></i>
                </div>
                <div>
                    <div style="font-size:1.7rem; font-weight:700; color:var(--espresso); line-height:1;">{{
                        total_orders }}</div>
                    <div
                        style="font-size:0.75rem; color:#aaa; text-transform:uppercase; letter-spacing:0.05em; margin-top:0.1rem;">
                        Заказов</div>
                </div>
                <a href="{{ url_for('orders_list') }}" class="ms-auto btn btn-sm btn-outline-success"
                    style="font-size:0.72rem; white-space:nowrap;">Просмотр</a>
            </div>
        </div>
    </div>

    <div class="col-md-3 col-sm-6">
        <div class="card" style="border-left:3px solid var(--latte);">
            <div class="card-body d-flex align-items-center gap-3" style="padding:1.1rem;">
                <div
                    style="width:44px; height:44px; background:var(--steam); border-radius:2px; display:flex; align-items:center; justify-content:center; flex-shrink:0;">
                    <i class="bi bi-people" style="font-size:1.3rem; color:var(--latte);"></i>
                </div>
                <div>
                    <div style="font-size:1.7rem; font-weight:700; color:var(--espresso); line-height:1;">{{
                        total_customers }}</div>
                    <div
                        style="font-size:0.75rem; color:#aaa; text-transform:uppercase; letter-spacing:0.05em; margin-top:0.1rem;">
                        Клиентов</div>
                </div>
                <a href="{{ url_for('customers_list') }}" class="ms-auto btn btn-sm btn-outline-primary"
                    style="font-size:0.72rem; white-space:nowrap;">Просмотр</a>
            </div>
        </div>
    </div>

    <div class="col-md-3 col-sm-6">
        <div class="card" style="border-left:3px solid #888;">
            <div class="card-body d-flex align-items-center gap-3" style="padding:1.1rem;">
                <div
                    style="width:44px; height:44px; background:var(--steam); border-radius:2px; display:flex; align-items:center; justify-content:center; flex-shrink:0;">
                    <i class="bi bi-person-badge" style="font-size:1.3rem; color:#888;"></i>
                </div>
                <div>
                    <div style="font-size:1.7rem; font-weight:700; color:var(--espresso); line-height:1;">{{ total_users
                        }}</div>
                    <div
                        style="font-size:0.75rem; color:#aaa; text-transform:uppercase; letter-spacing:0.05em; margin-top:0.1rem;">
                        Пользователей</div>
                </div>
                <a href="{{ url_for('admin_users_list') }}" class="ms-auto btn btn-sm btn-outline-secondary"
                    style="font-size:0.72rem; white-space:nowrap;">Просмотр</a>
            </div>
        </div>
    </div>

</div>

<!-- ── Recent data ─────────────────────────────────────────────── -->
<div class="row g-3 mb-4">

    <!-- Recent Products -->
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-clock-history me-2 text-muted"></i>Последние продукты</span>
                <a href="{{ url_for('admin_products') }}" style="font-size:0.75rem; color:var(--latte);">Все →</a>
            </div>
            <div class="card-body p-0">
                {% if recent_products %}
                <div class="list-group list-group-flush">
                    {% for product in recent_products %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <div style="font-weight:500; font-size:0.875rem; color:var(--espresso);">{{
                                product.product_name }}</div>
                            <small class="text-muted">{{ product.category.category_name }}</small>
                        </div>
                        <span style="font-weight:600; font-size:0.875rem; color:var(--coffee);">
                            {{ product.price | currency }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center text-muted py-4" style="font-size:0.85rem;">Пока нет продуктов</div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Recent Orders -->
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-receipt me-2 text-muted"></i>Последние заказы</span>
                <a href="{{ url_for('orders_list') }}" style="font-size:0.75rem; color:var(--latte);">Все →</a>
            </div>
            <div class="card-body p-0">
                {% if recent_orders %}
                <div class="list-group list-group-flush">
                    {% for order in recent_orders %}
                    <div class="list-group-item d-flex justify-content-between align-items-start py-2">
                        <div>
                            <div style="font-weight:500; font-size:0.875rem; color:var(--espresso);">
                                #{{ order.order_id }}
                            </div>
                            <small class="text-muted">{{ order.order_date.strftime('%d.%m.%Y %H:%M') }}</small>
                        </div>
                        <div class="text-end">
                            <span class="badge
                                {% if order.status == 'completed' %}bg-success
                                {% elif order.status == 'cancelled' %}bg-danger
                                {% else %}bg-warning{% endif %}
                                mb-1">
                                {{ order.status | status_text }}
                            </span>
                            <div style="font-weight:600; font-size:0.875rem; color:var(--espresso);">
                                {{ order.total_amount | currency }}
                            </div>
                            <a href="{{ url_for('order_detail', order_id=order.order_id) }}"
                                style="font-size:0.72rem; color:var(--latte);">Просмотр →</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center text-muted py-4" style="font-size:0.85rem;">Пока нет заказов</div>
                {% endif %}
            </div>
        </div>
    </div>

</div>

<!-- ── Quick actions ───────────────────────────────────────────── -->
<div class="card">
    <div class="card-header">
        <i class="bi bi-lightning me-2 text-muted"></i>Быстрые действия
    </div>
    <div class="card-body" style="padding:1.25rem;">
        <div class="d-flex flex-wrap gap-2">

            <a href="{{ url_for('admin_product_add') }}" class="btn btn-outline-primary">
                <i class="bi bi-plus-circle me-2"></i>Добавить продукт
            </a>
            <a href="{{ url_for('admin_products') }}" class="btn btn-outline-primary">
                <i class="bi bi-list-ul me-2"></i>Продукты
            </a>
            <a href="{{ url_for('inventory') }}" class="btn btn-outline-secondary">
                <i class="bi bi-box-seam me-2"></i>Склад
            </a>
            <a href="{{ url_for('orders_list') }}" class="btn btn-outline-secondary">
                <i class="bi bi-receipt me-2"></i>Заказы
            </a>
            <a href="{{ url_for('analytics') }}" class="btn btn-outline-secondary">
                <i class="bi bi-graph-up me-2"></i>Аналитика
            </a>
            <a href="{{ url_for('customers_list') }}" class="btn btn-outline-secondary">
                <i class="bi bi-people me-2"></i>Клиенты
            </a>
            <a href="{{ url_for('admin_users_list') }}" class="btn btn-outline-secondary">
                <i class="bi bi-person-list me-2"></i>Пользователи
            </a>
            {% if current_user.role == 'admin' %}
            <a href="{{ url_for('backup.index') }}" class="btn btn-outline-danger">
                <i class="bi bi-database-fill-gear me-2"></i>Бэкапы
            </a>
            <a href="{{ url_for('admin_logs') }}" class="btn btn-outline-dark">
                <i class="bi bi-journal-text me-2"></i>Логи
            </a>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    (function tick() {
        const el = document.getElementById('dashClock');
        if (el) el.textContent = new Date().toLocaleString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' });
        setTimeout(tick, 1000);
    })();
</script>
{% endblock %}