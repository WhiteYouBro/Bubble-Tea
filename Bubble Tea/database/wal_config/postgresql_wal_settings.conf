# PostgreSQL WAL Configuration for Bubble Tea Database
# Add these settings to postgresql.conf

# ======================================
# WAL (Write-Ahead Logging) Settings
# ======================================

# Enable WAL archiving
wal_level = replica                    # minimal, replica, or logical
archive_mode = on                      # Enable archiving
archive_command = 'copy "%p" "C:\\Users\\VICTUS\\Downloads\\Alisher Downloads\\Bubble Tea\\backups\\wal_archive\\%f"'

# WAL file size and retention
wal_keep_size = 1GB                    # Keep at least 1GB of WAL files
max_wal_size = 2GB                     # Maximum size before checkpoint
min_wal_size = 80MB                    # Minimum reserved WAL

# Checkpoints
checkpoint_timeout = 15min             # Time between automatic checkpoints
checkpoint_completion_target = 0.9     # Spread checkpoint I/O

# ======================================
# Replication Settings (for future)
# ======================================
max_wal_senders = 3                    # Maximum concurrent replication connections
wal_sender_timeout = 60s               # Timeout for replication

# ======================================
# Recovery Settings
# ======================================
restore_command = 'copy "C:\\Users\\VICTUS\\Downloads\\Alisher Downloads\\Bubble Tea\\backups\\wal_archive\\%f" "%p"'

# ======================================
# Logging Settings
# ======================================
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on
log_duration = off
log_statement = 'mod'                  # Log all data-modifying statements

# ======================================
# Performance Monitoring
# ======================================
shared_preload_libraries = 'pg_stat_statements'
pg_stat_statements.track = all
track_activities = on
track_counts = on
track_io_timing = on


